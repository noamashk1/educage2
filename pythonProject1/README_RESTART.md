# מערכת האתחול מחדש - Educage2

## מה זה?
מערכת אוטומטית שמאפשרת לאתחל מחדש ניסוי שנפסק, תוך שמירה על כל הפרמטרים והנתונים. המערכת כוללת ניטור זיכרון אוטומטי שמאתחל מחדש כאשר השימוש בזיכרון עולה מעל סף מסוים.

## איך זה עובד?

### 1. שמירה אוטומטית
כאשר המשתמש לוחץ על OK ב-GUI, המערכת שומרת אוטומטית:
- פרמטרי הניסוי (`exp_params`)
- רשימת הרמות (`levels_df`) 
- רשימת העכברים (`mice_dict`)
- שם קובץ הטקסט (`txt_file_name`)
- נתיב קובץ הטקסט (`txt_file_path`)

המצב נשמר בקובץ `minimal_state.pkl` בתיקיית הניסוי.

### 2. ניטור זיכרון אוטומטי
- המערכת בודקת את השימוש בזיכרון כל 5 שניות
- ברירת המחדל: סף של 150MB
- כאשר השימוש בזיכרון עולה מעל הסף:
  - המערכת שומרת את המצב הנוכחי אוטומטית
  - יוצרת סקריפט אתחול מחדש
  - מאתחלת מחדש את הניסוי עם אותם פרמטרים
  - **המשתמש לא צריך לעשות כלום!**

### 3. אתחול מחדש
יש שתי דרכים לאתחל מחדש:

#### דרך א': אוטומטי (מומלץ)
המערכת מאתחלת מחדש אוטומטית כאשר יש בעיית זיכרון.

#### דרך ב': שורת פקודה (למקרים מיוחדים)
```bash
python experiment.py --restart <שם_הניסוי>
```
לדוגמה:
```bash
python experiment.py --restart exp_24_08_2025
```

#### דרך ג': דרך ה-GUI
כאשר יוצרים תיקיית ניסוי קיימת, המערכת תבדוק אם יש קובץ מצב זמין ותציע לאתחל מחדש.

### 4. מה קורה באתחול?
- המערכת טוענת את כל הפרמטרים שנשמרו
- ה-GUI עולה עם הפרמטרים הקודמים
- ה-live_window נפתח אוטומטית
- הניסוי מתחיל אוטומטית ללא צורך בהגדרת פרמטרים מחדש
- מערכת ניטור הזיכרון מתחילה מחדש

## קבצים שנוספו/שונו

### קבצים חדשים:
- `state_io.py` - מודול לשמירה וטעינה של המצב
- `memory_monitor.py` - מערכת ניטור זיכרון אוטומטית

### קבצים שעודכנו:
- `experiment.py` - הוספת תמיכה באתחול מחדש וניטור זיכרון
- `GUI_sections.py` - שמירה אוטומטית של המצב
- `requirements.txt` - הוספת psutil לניטור זיכרון

## דוגמה לשימוש

### הפעלה רגילה:
```bash
python experiment.py
```

### הגדרת פרמטרים ב-GUI ולוחץ OK:
- המערכת שומרת את המצב אוטומטית
- מערכת ניטור הזיכרון מתחילה לפעול

### אתחול אוטומטי:
- כאשר הזיכרון עולה מעל 150MB
- המערכת שומרת את המצב
- מאתחלת מחדש אוטומטית
- המשתמש רואה שהניסוי מתחיל מחדש

## הגדרות ניטור הזיכרון

ניתן לשנות את הגדרות ניטור הזיכרון ב-`experiment.py`:

```python
self.memory_monitor = memory_monitor.MemoryMonitor(
    self, 
    threshold_mb=150,      # סף הזיכרון ב-MB
    check_interval=5       # זמן בין בדיקות בשניות
)
```

## הערות חשובות
- המערכת שומרת רק את הנתונים הבסיסיים הנדרשים לאתחול
- לא נשמרים נתוני ניסוי או תוצאות
- ה-GUI וה-live_window עולים אוטומטית באתחול
- הניסוי מתחיל מיד ללא צורך בהתערבות המשתמש
- **ניטור הזיכרון פועל אוטומטית ברקע**
- המערכת מאתחלת מחדש אוטומטית בעת בעיות זיכרון
